import{r as u,j as e,H as b,a as g}from"./app-DVcLmPf8.js";import{A as v}from"./AuthenticatedLayout-C_D7FIdQ.js";import{T as N}from"./Toast-DluL9eP1.js";import"./transition-CZNjKHZc.js";function D({auth:n,isParent:a,children:l,students:c,selectedDate:t,flash:r}){const[i,o]=u.useState(null);return u.useEffect(()=>{r?.success?o({message:r.success,type:"success"}):r?.error&&o({message:r.error,type:"error"})},[r]),e.jsxs(v,{user:n.user,header:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-semibold leading-tight text-zinc-900",children:"Kehadiran"}),a&&e.jsx("span",{className:"text-sm text-zinc-500",children:"Rekod Kehadiran Anak"})]}),children:[e.jsx(b,{title:"Kehadiran"}),i&&e.jsx(N,{message:i.message,type:i.type,onClose:()=>o(null)}),e.jsx("div",{className:"py-6 sm:py-12 bg-zinc-50 min-h-screen",children:e.jsx("div",{className:"mx-auto max-w-7xl px-4 sm:px-6",children:a?e.jsx(w,{childrenData:l}):e.jsx(k,{students:c,selectedDate:t,setToast:o})})})]})}function w({childrenData:n}){return!n||n.length===0?e.jsx("div",{className:"text-center p-12 bg-white rounded-xl border border-dashed border-zinc-300",children:e.jsx("p",{className:"text-zinc-500",children:'Tiada rekod peserta dijumpai. Sila tambah peserta terlebih dahulu di menu "Nama Peserta".'})}):e.jsx("div",{className:"space-y-6",children:n.map(a=>{const l=a.stats||{present:0,total_classes:0},c=l.total_classes>0?Math.round(l.present/l.total_classes*100):0;return e.jsxs("div",{className:"bg-white rounded-2xl border border-zinc-200 shadow-lg shadow-zinc-100/50 p-4 sm:p-5 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-48 h-48 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-full blur-3xl opacity-40 -translate-y-1/2 translate-x-1/3"}),e.jsxs("div",{className:"relative z-10 flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-5",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-14 w-14 rounded-xl bg-zinc-900 text-white flex items-center justify-center text-xl font-bold shadow-md",children:a.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black text-zinc-900 tracking-tight",children:a.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5 text-xs text-zinc-500 font-medium",children:[e.jsxs("span",{children:["ID: ",a.no_keahlian]}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{className:"text-blue-600",children:"Pelajar Aktif"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 bg-zinc-50 px-4 py-3 rounded-xl border border-zinc-100",children:[e.jsxs("div",{className:"relative w-14 h-14",children:[e.jsx(y,{percentage:c,color:"text-blue-600"}),e.jsxs("div",{className:"absolute inset-0 flex items-center justify-center font-bold text-xs text-zinc-700",children:[c,"%"]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-2xl font-black text-zinc-900",children:l.present}),e.jsxs("span",{className:"text-sm text-zinc-400 font-medium",children:["/ ",l.total_classes]})]}),e.jsx("div",{className:"text-[10px] font-bold text-zinc-500 uppercase tracking-wide",children:"Jumlah Kehadiran"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"lg:col-span-2 bg-gradient-to-b from-white to-zinc-50 rounded-xl border border-zinc-200 p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h4",{className:"text-sm font-bold text-zinc-800 flex items-center gap-2",children:[e.jsx("span",{className:"w-0.5 h-4 bg-blue-500 rounded-full"}),"Prestasi Bulanan ",new Date().getFullYear()]}),e.jsxs("div",{className:"flex gap-3 text-[10px] font-medium",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-500"})," Hadir"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-rose-400"})," Ponteng"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-amber-400"})," Sakit"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-purple-400"})," Cuti"]})]})]}),e.jsx(z,{attendances:a.attendances})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-1 gap-3",children:[e.jsx(p,{label:"Kelas Dihadiri",value:l.present+" Kelas",desc:"Sangat Bagus!",icon:"ðŸ”¥",bg:"bg-orange-50",text:"text-orange-700"}),e.jsx(p,{label:"Tidak Hadir",value:l.total_classes-l.present+" Kelas",desc:"Sila beri tumpuan",icon:"âš ï¸",bg:"bg-rose-50",text:"text-rose-700"}),e.jsx(p,{label:"Kadar Kehadiran",value:c+"%",desc:"Purata tahunan",icon:"ðŸ“ˆ",bg:"bg-blue-50",text:"text-blue-700"})]})]})]},a.id)})})}const p=({label:n,value:a,desc:l,icon:c,bg:t,text:r})=>e.jsxs("div",{className:`p-3 rounded-lg border border-zinc-100 ${t} flex items-start gap-3 transition-transform hover:scale-[1.02]`,children:[e.jsx("div",{className:"text-xl pt-0.5",children:c}),e.jsxs("div",{children:[e.jsx("div",{className:`text-base font-black ${r}`,children:a}),e.jsx("div",{className:"text-[10px] font-bold text-zinc-500 uppercase tracking-wider mb-0.5",children:n}),e.jsx("div",{className:"text-[10px] text-zinc-400 font-medium",children:l})]})]}),y=({percentage:n,color:a})=>{const c=2*Math.PI*35,t=c-n/100*c;return e.jsxs("svg",{className:"transform -rotate-90 w-full h-full",viewBox:"0 0 80 80",children:[e.jsx("circle",{className:"text-zinc-200",strokeWidth:"8",stroke:"currentColor",fill:"transparent",r:35,cx:"40",cy:"40"}),e.jsx("circle",{className:`${a} transition-all duration-1000 ease-out`,strokeWidth:"8",strokeDasharray:c,strokeDashoffset:t,strokeLinecap:"round",stroke:"currentColor",fill:"transparent",r:35,cx:"40",cy:"40"})]})},z=({attendances:n})=>{const a=Array(12).fill(0).map(()=>({present:0,absent:0,sick:0,leave:0}));n&&n.forEach(t=>{const i=new Date(t.attendance_date).getMonth();t.status==="hadir"?a[i].present++:t.status==="tidak_hadir"?a[i].absent++:t.status==="sakit"?a[i].sick++:t.status==="cuti"&&a[i].leave++});const l=Math.max(...a.map(t=>t.present+t.absent+t.sick+t.leave),5),c=["Jan","Feb","Mac","Apr","Mei","Jun","Jul","Ogo","Sep","Okt","Nov","Dis"];return e.jsx("div",{className:"h-40 sm:h-48 flex items-end justify-between gap-2 sm:gap-3",children:a.map((t,r)=>{const i=t.present/l*100,o=t.absent/l*100,m=t.sick/l*100,h=t.leave/l*100;return e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-end h-full group cursor-pointer relative",children:[e.jsxs("div",{className:"absolute bottom-full mb-2 opacity-0 group-hover:opacity-100 transition-opacity bg-zinc-800 text-white text-[10px] py-1 px-2 rounded pointer-events-none z-20 whitespace-nowrap",children:[c[r],": ",t.present," Hadir, ",t.sick," Sakit, ",t.leave," Cuti, ",t.absent," Ponteng"]}),e.jsxs("div",{className:"w-full max-w-[24px] bg-zinc-100 rounded-t-sm flex flex-col justify-end overflow-hidden relative",style:{height:"100%"},children:[e.jsx("div",{className:"bg-transparent flex-grow"}),o>0&&e.jsx("div",{style:{height:`${o}%`},className:"w-full bg-rose-400 transition-all duration-700"}),o>0&&(h>0||m>0||i>0)&&e.jsx("div",{className:"h-[1px] bg-white w-full"}),h>0&&e.jsx("div",{style:{height:`${h}%`},className:"w-full bg-purple-400 transition-all duration-700"}),h>0&&(m>0||i>0)&&e.jsx("div",{className:"h-[1px] bg-white w-full"}),m>0&&e.jsx("div",{style:{height:`${m}%`},className:"w-full bg-amber-400 transition-all duration-700"}),m>0&&i>0&&e.jsx("div",{className:"h-[1px] bg-white w-full"}),i>0&&e.jsx("div",{style:{height:`${i}%`},className:"w-full bg-blue-500 transition-all duration-700 rounded-t-xs"}),i===0&&o===0&&m===0&&h===0&&e.jsx("div",{className:"h-[2px] w-full bg-zinc-200"})]}),e.jsx("span",{className:"text-[10px] font-bold text-zinc-400 mt-2 uppercase tracking-tight",children:c[r]})]},r)})})};function k({students:n,selectedDate:a,setToast:l}){const[c,t]=u.useState(a),[r,i]=u.useState({});u.useEffect(()=>{const s={};n.forEach(d=>{d.attendance_status&&(s[d.id]={status:d.attendance_status,notes:d.notes||""})}),i(s)},[n]);const o=s=>{t(s),g.get(route("attendance.index"),{date:s},{preserveState:!0,preserveScroll:!0})},m=(s,d)=>{i(x=>({...x,[s]:{...x[s],status:d}}))},h=(s,d)=>{i(x=>({...x,[s]:{...x[s],notes:d}}))},j=()=>{const s=Object.entries(r).filter(([d,x])=>x.status).map(([d,x])=>({student_id:parseInt(d),status:x.status,notes:x.notes||null}));if(s.length===0){l({message:"Sila tandakan data dahulu.",type:"error"});return}g.post(route("attendance.bulk-mark"),{attendance_date:c,attendances:s})},f={total:n.length,hadir:Object.values(r).filter(s=>s.status==="hadir").length,tidak_hadir:Object.values(r).filter(s=>s.status==="tidak_hadir").length};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl border border-zinc-200 shadow-sm p-4 flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 w-full sm:w-auto",children:[e.jsx("span",{className:"text-sm font-medium text-zinc-600",children:"Tarikh:"}),e.jsx("input",{type:"date",value:c,onChange:s=>o(s.target.value),className:"px-3 py-2 border border-zinc-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{className:"flex items-center gap-4 w-full sm:w-auto justify-between sm:justify-end",children:[e.jsxs("div",{className:"flex gap-3 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1 text-green-700 font-medium",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500"})," Hadir: ",f.hadir]}),e.jsxs("span",{className:"flex items-center gap-1 text-red-700 font-medium",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-red-500"})," Absent: ",f.tidak_hadir]})]}),e.jsx("button",{onClick:j,className:"px-4 py-2 bg-black text-white text-sm font-medium rounded-lg hover:bg-zinc-800 transition-colors",children:"Simpan"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-zinc-200 shadow-sm overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-zinc-50 border-b border-zinc-200 text-zinc-500 font-medium",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 w-24",children:"No."}),e.jsx("th",{className:"px-6 py-3",children:"Peserta"}),e.jsx("th",{className:"px-6 py-3 w-48",children:"Status"}),e.jsx("th",{className:"px-6 py-3",children:"Catatan"})]})}),e.jsx("tbody",{className:"divide-y divide-zinc-100",children:n.map(s=>e.jsxs("tr",{className:"hover:bg-zinc-50/50",children:[e.jsx("td",{className:"px-6 py-3 text-zinc-500 font-mono text-xs",children:s.no_siri}),e.jsxs("td",{className:"px-6 py-3",children:[e.jsx("div",{className:"font-medium text-zinc-900",children:s.nama_pelajar}),e.jsx("div",{className:"text-xs text-zinc-500 capitalize",children:s.kategori})]}),e.jsx("td",{className:"px-6 py-3",children:e.jsxs("select",{value:r[s.id]?.status||"",onChange:d=>m(s.id,d.target.value),className:"w-full px-2 py-1.5 text-sm border-zinc-300 rounded-md focus:ring-1 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"- Pilih -"}),e.jsx("option",{value:"hadir",children:"Hadir"}),e.jsx("option",{value:"tidak_hadir",children:"Tidak Hadir"}),e.jsx("option",{value:"cuti",children:"Cuti"}),e.jsx("option",{value:"sakit",children:"Sakit"})]})}),e.jsx("td",{className:"px-6 py-3",children:e.jsx("input",{type:"text",value:r[s.id]?.notes||"",onChange:d=>h(s.id,d.target.value),placeholder:"...",className:"w-full px-2 py-1.5 text-sm border-zinc-300 rounded-md focus:ring-1 focus:ring-blue-500 focus:border-blue-500"})})]},s.id))})]})}),n.length===0&&e.jsx("div",{className:"p-8 text-center text-zinc-500",children:"Tiada peserta."})]})]})}export{D as default};
