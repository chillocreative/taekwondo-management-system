import{r as o,j as e,H as f,a as h}from"./app-C2IhyUkP.js";import{A as g}from"./AuthenticatedLayout-DobwFdSM.js";import"./transition-B275MVl5.js";function k({students:p,stats:t}){const[r,n]=o.useState("all"),[i,j]=o.useState(null),[x,m]=o.useState(!1),c=p.filter(s=>r==="discrepancy"?s.discrepancy==="PAID_BUT_MARKED_UNPAID":r==="correct"?s.discrepancy==="CORRECTLY_UNPAID":!0),b=async()=>{if(confirm(`Ini akan menandakan SEMUA ${t.has_discrepancy} pelajar yang mempunyai resit sebagai SUDAH BAYAR. Teruskan?`)){m(!0);try{const a=await(await fetch(route("admin.payment-verification.bulk-mark-paid"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content}})).json();a.success?(alert(`âœ… Berjaya! ${a.fixed} pelajar telah dikemaskini.`),h.reload()):alert("Gagal: "+(a.error||"Unknown error"))}catch(s){alert("Error: "+s.message)}finally{m(!1)}}},u=async(s,a)=>{if(confirm(`Tandakan ${a} sebagai SUDAH BAYAR untuk tahun 2026?`))try{const d=await(await fetch(route("admin.payment-verification.mark-paid"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({child_id:s})})).json();d.success?(alert(d.message),h.reload()):alert("Gagal: "+(d.error||"Unknown error"))}catch(l){alert("Error: "+l.message)}},N=s=>{window.open(`/receipts/${s}`,"_blank")};return e.jsxs(g,{children:[e.jsx(f,{title:"Payment Verification"}),e.jsx("div",{className:"py-6 sm:py-12 bg-zinc-50 min-h-screen",children:e.jsxs("div",{className:"mx-auto max-w-7xl px-4 sm:px-6",children:[e.jsxs("div",{className:"bg-white rounded-xl border border-zinc-200 shadow-sm p-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-zinc-900",children:"ðŸ” Payment Verification Tool"}),e.jsx("p",{className:"text-zinc-500 mt-1",children:"Semak dan sahkan status pembayaran pelajar"})]}),t.has_discrepancy>0&&e.jsx("button",{onClick:b,disabled:x,className:"px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 font-medium shadow-lg",children:x?"â³ Memproses...":`âœ… Baiki Semua (${t.has_discrepancy})`})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 cursor-pointer hover:bg-blue-100",onClick:()=>n("all"),children:[e.jsx("p",{className:"text-blue-800 font-medium text-sm",children:"Jumlah Belum Bayar"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:t.total_unpaid})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 cursor-pointer hover:bg-red-100",onClick:()=>n("discrepancy"),children:[e.jsx("p",{className:"text-red-800 font-medium text-sm",children:"âš ï¸ Ada Discrepancy"}),e.jsx("p",{className:"text-2xl font-bold text-red-900",children:t.has_discrepancy})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 cursor-pointer hover:bg-green-100",onClick:()=>n("correct"),children:[e.jsx("p",{className:"text-green-800 font-medium text-sm",children:"âœ… Betul Belum Bayar"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:t.correctly_unpaid})]})]})]}),r!=="all"&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg px-4 py-2 mb-4 flex justify-between items-center",children:[e.jsxs("span",{className:"text-blue-800",children:["Menapis: ",e.jsx("strong",{className:"capitalize",children:r==="discrepancy"?"Ada Discrepancy":"Betul Belum Bayar"})," (",c.length," rekod)"]}),e.jsx("button",{onClick:()=>n("all"),className:"text-blue-600 hover:text-blue-800 font-medium",children:"Padam Filter âœ•"})]}),e.jsx("div",{className:"bg-white rounded-xl border border-zinc-200 shadow-sm overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-zinc-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-4 font-bold text-zinc-600",children:"No. Siri"}),e.jsx("th",{className:"text-left p-4 font-bold text-zinc-600",children:"Nama Pelajar"}),e.jsx("th",{className:"text-left p-4 font-bold text-zinc-600",children:"Penjaga"}),e.jsx("th",{className:"text-center p-4 font-bold text-zinc-600",children:"Bayaran 2026"}),e.jsx("th",{className:"text-center p-4 font-bold text-zinc-600",children:"Status"}),e.jsx("th",{className:"text-center p-4 font-bold text-zinc-600",children:"Tindakan"})]})}),e.jsx("tbody",{className:"divide-y divide-zinc-100",children:c.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center py-12 text-zinc-500",children:"Tiada rekod ditemui"})}):c.map(s=>e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:`hover:bg-zinc-50 ${s.discrepancy==="PAID_BUT_MARKED_UNPAID"?"bg-red-50/50":""}`,children:[e.jsx("td",{className:"p-4 font-medium",children:s.no_siri}),e.jsxs("td",{className:"p-4",children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-xs text-zinc-500",children:s.training_center})]}),e.jsx("td",{className:"p-4 text-zinc-600",children:s.parent_name}),e.jsx("td",{className:"p-4 text-center",children:e.jsxs("div",{className:"flex flex-col gap-1 items-center",children:[e.jsxs("span",{className:"text-xs text-zinc-500",children:[s.total_payments_2026," transaksi"]}),s.latest_receipt&&e.jsxs("code",{className:"bg-zinc-100 px-2 py-1 rounded text-xs",children:["#",s.latest_receipt]}),s.latest_amount&&e.jsxs("span",{className:"text-xs font-bold",children:["RM ",s.latest_amount]})]})}),e.jsx("td",{className:"p-4 text-center",children:s.discrepancy==="PAID_BUT_MARKED_UNPAID"?e.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-700 rounded-full text-xs font-medium",children:"âš ï¸ Sudah Bayar (Perlu Update)"}):e.jsx("span",{className:"px-2 py-1 bg-amber-100 text-amber-700 rounded-full text-xs font-medium",children:"â³ Belum Bayar"})}),e.jsx("td",{className:"p-4 text-center",children:e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx("button",{onClick:()=>j(i===s.child_id?null:s.child_id),className:"px-3 py-1 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 text-xs font-medium",children:i===s.child_id?"â–² Tutup":"â–¼ Details"}),s.discrepancy==="PAID_BUT_MARKED_UNPAID"&&e.jsx("button",{onClick:()=>u(s.child_id,s.name),className:"px-3 py-1 bg-green-600 text-white rounded-lg hover:bg-green-700 text-xs font-medium",children:"âœ… Tandakan Sudah Bayar"})]})})]},s.child_id),i===s.child_id&&e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"p-4 bg-zinc-50",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-bold text-sm",children:"ðŸ“‹ Payment History 2026"}),s.all_payments.length===0?e.jsx("p",{className:"text-xs text-zinc-500",children:"Tiada rekod pembayaran 2026"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:s.all_payments.map((a,l)=>e.jsxs("div",{className:"bg-white border border-zinc-200 rounded p-3 text-xs",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-bold",children:["Receipt #",a.receipt_number]}),e.jsx("div",{className:"text-zinc-500",children:a.month})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-bold text-green-600",children:["RM ",a.total]}),e.jsx("div",{className:"text-zinc-400 text-[10px]",children:a.payment_date})]})]}),e.jsxs("div",{className:"flex gap-2 text-[10px] text-zinc-500",children:[e.jsxs("span",{children:["Base: RM",a.amount]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:["Total: RM",a.total]})]}),a.receipt_number&&e.jsx("button",{onClick:()=>N(a.receipt_number),className:"mt-2 w-full px-2 py-1 bg-blue-50 text-blue-600 rounded text-[10px] font-medium hover:bg-blue-100",children:"ðŸ“„ Lihat Resit"})]},l))}),e.jsxs("div",{className:"pt-2 border-t border-zinc-200",children:[e.jsx("h5",{className:"font-bold text-xs mb-1",children:"Database Info:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-zinc-500",children:"Payment Completed:"}),e.jsx("span",{className:`ml-2 font-medium ${s.payment_completed?"text-green-600":"text-red-600"}`,children:s.payment_completed?"TRUE":"FALSE"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-zinc-500",children:"Payment Date:"}),e.jsx("span",{className:"ml-2 font-medium",children:s.payment_date||"NULL"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-zinc-500",children:"Last Updated Year:"}),e.jsx("span",{className:"ml-2 font-medium",children:s.last_updated_year||"NULL"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-zinc-500",children:"Registration Type:"}),e.jsx("span",{className:"ml-2 font-medium",children:s.registration_type||"NULL"})]})]})]})]})})})]}))})]})})})]})})]})}export{k as default};
