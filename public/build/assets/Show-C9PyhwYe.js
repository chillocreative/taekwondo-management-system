import{b as D,r as n,j as e,H as _,a as g}from"./app-DkCyPcKf.js";import{A as T}from"./AuthenticatedLayout-B5dsNmYA.js";import{T as f}from"./Toast-CddcEfjk.js";import"./transition-Butwge-e.js";function K({auth:b,trainingCenter:l,students:i,date:j}){const{flash:c={}}=D().props,[d,w]=n.useState(j),[o,x]=n.useState({}),[u,m]=n.useState(!1),[h,y]=n.useState("");new Date(d).toDateString(),new Date().toDateString();const N=new Date().toISOString().split("T")[0],s=d===N||b.user.role==="admin";n.useEffect(()=>{const t={};i&&Array.isArray(i)&&i.forEach(a=>{t[a.id]={status:a.status||"hadir",notes:a.notes||""}}),x(t)},[i]);const z=t=>{const a=t.target.value;w(a),g.get(route("coach.attendance.show"),{date:a,center_id:l.id},{preserveState:!0,preserveScroll:!0})},S=(t,a)=>{s&&x(r=>({...r,[t]:{...r[t],status:a}}))},v=(t,a)=>{s&&x(r=>({...r,[t]:{...r[t],notes:a}}))},k=()=>{m(!0);const t=Object.entries(o).map(([a,r])=>({student_id:parseInt(a),status:r.status,notes:r.notes}));g.post(route("coach.attendance.store"),{date:d,center_id:l.id,attendances:t},{onFinish:()=>m(!1),preserveScroll:!0})},p=(i||[]).filter(t=>t?.name?.toLowerCase().includes(h.toLowerCase())||t?.no_siri?.toLowerCase().includes(h.toLowerCase())),C=(t,a)=>{if(!(t===a))return"bg-white border-zinc-200 text-zinc-600 hover:bg-zinc-50";switch(t){case"hadir":return"bg-green-100 border-green-300 text-green-700 font-bold ring-1 ring-green-500";case"tidak_hadir":return"bg-red-100 border-red-300 text-red-700 font-bold ring-1 ring-red-500";case"sakit":return"bg-yellow-100 border-yellow-300 text-yellow-700 font-bold ring-1 ring-yellow-500";case"cuti":return"bg-blue-100 border-blue-300 text-blue-700 font-bold ring-1 ring-blue-500";default:return"bg-white border-zinc-200"}};return e.jsxs(T,{user:b.user,header:e.jsx("h2",{className:"font-bold text-2xl text-zinc-900 leading-tight",children:"Pengurusan Kehadiran"}),children:[e.jsx(_,{title:"Kehadiran"}),c.success&&e.jsx(f,{message:c.success,type:"success"}),c.error&&e.jsx(f,{message:c.error,type:"error"}),e.jsx("div",{className:"py-12 bg-zinc-50 min-h-screen",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-zinc-200 mb-6 flex flex-col md:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-zinc-900",children:l.name}),e.jsx("p",{className:"text-zinc-500",children:"Rekod kehadiran pelajar"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-zinc-700",children:"Tarikh:"}),e.jsx("input",{type:"date",value:d,onChange:z,className:"rounded-lg border-zinc-300 focus:ring-black focus:border-black"})]})]}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("input",{type:"text",placeholder:"Cari nama atau no. siri...",value:h,onChange:t=>y(t.target.value),className:"rounded-lg border-zinc-300 w-full md:w-64 focus:ring-black focus:border-black"}),s&&e.jsx("button",{onClick:k,disabled:u,className:"bg-black text-white px-6 py-2 rounded-lg font-bold hover:bg-zinc-800 transition-colors shadow-lg disabled:opacity-50",children:u?"Menyimpan...":"Simpan Kehadiran"}),!s&&e.jsx("span",{className:"bg-zinc-100 text-zinc-500 px-4 py-2 rounded-lg font-medium border border-zinc-200",children:"Mod Lihat Sahaja"})]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-xl border border-zinc-200 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-zinc-200",children:[e.jsx("thead",{className:"bg-zinc-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-zinc-500 uppercase tracking-wider w-1/4",children:"Pelajar"}),e.jsx("th",{className:"px-6 py-4 text-center text-xs font-bold text-zinc-500 uppercase tracking-wider w-1/2",children:"Status Kehadiran"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-zinc-500 uppercase tracking-wider w-1/4",children:"Catatan"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-zinc-100",children:p.length>0?p.map(t=>e.jsxs("tr",{className:"hover:bg-zinc-50/50",children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"font-bold text-zinc-900",children:t.name}),e.jsx("div",{className:"text-xs text-zinc-500 font-mono",children:t.no_siri})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"flex justify-center gap-2",children:["hadir","tidak_hadir","sakit","cuti"].map(a=>e.jsxs("button",{onClick:()=>S(t.id,a),disabled:!s,className:`px-3 py-2 rounded-lg text-xs font-medium border transition-all duration-200 ${C(a,o[t.id]?.status)} ${s?"":"cursor-not-allowed opacity-75"}`,children:[a==="hadir"&&"Hadir",a==="tidak_hadir"&&"Tidak Hadir",a==="sakit"&&"Sakit",a==="cuti"&&"Cuti"]},a))})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("input",{type:"text",placeholder:s?"Tambah nota...":"-",value:o[t.id]?.notes||"",onChange:a=>v(t.id,a.target.value),disabled:!s,className:"w-full text-sm rounded-lg border-zinc-200 focus:border-black focus:ring-0 disabled:bg-transparent disabled:border-none disabled:px-0 placeholder-zinc-300"})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"3",className:"px-6 py-12 text-center text-zinc-400",children:"Tiada pelajar dijumpai."})})})]})})})]})})]})}export{K as default};
