import{r as n,j as e,H as S,a as y}from"./app-BkIAFqYx.js";import{A as w}from"./AuthenticatedLayout-CKOuTCLE.js";import"./transition-B1lV0-K-.js";function R({pendingPayments:d,paidPayments:m,stats:h}){const[p,b]=n.useState({}),[j,u]=n.useState({}),[g,N]=n.useState(!1),[i,c]=n.useState({}),[a,o]=n.useState(null),[l,f]=n.useState("pending"),v=async s=>{b(t=>({...t,[s]:!0}));try{const r=await(await fetch(route("admin.payment-reconciliation.check"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({child_id:s})})).json();c(x=>({...x,[s]:r}))}catch(t){c(r=>({...r,[s]:{error:t.message}}))}b(t=>({...t,[s]:!1}))},k=async s=>{u(t=>({...t,[s]:!0}));try{const r=await(await fetch(route("admin.payment-reconciliation.fix"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({child_id:s})})).json();r.success?y.reload():c(x=>({...x,[s]:{error:r.error}}))}catch(t){c(r=>({...r,[s]:{error:t.message}}))}u(t=>({...t,[s]:!1}))},z=async()=>{if(confirm("Ini akan menyemak SEMUA pembayaran pending dengan ToyyibPay dan memperbaiki status yang tidak sepadan. Teruskan?")){N(!0),o(null);try{const t=await(await fetch(route("admin.payment-reconciliation.bulk"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content}})).json();o(t),t.fixed>0&&setTimeout(()=>{y.reload()},3e3)}catch(s){o({error:s.message})}N(!1)}};return e.jsxs(w,{children:[e.jsx(S,{title:"Payment Reconciliation"}),e.jsx("div",{className:"py-6 sm:py-12 bg-zinc-50 min-h-screen",children:e.jsxs("div",{className:"mx-auto max-w-7xl px-4 sm:px-6",children:[e.jsxs("div",{className:"bg-white rounded-xl border border-zinc-200 shadow-sm p-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-zinc-900",children:"Payment Reconciliation"}),e.jsx("p",{className:"text-zinc-500 mt-1",children:"Semak dan perbaiki status pembayaran yang tidak sepadan dengan ToyyibPay"})]}),e.jsx("button",{onClick:z,disabled:g,className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 font-medium",children:g?"Memproses...":"ðŸ”§ Auto-Repair All Pending"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-6",children:[e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-amber-800 font-medium",children:"Menunggu Bayaran"}),e.jsx("p",{className:"text-3xl font-bold text-amber-900",children:h.total_pending})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-green-800 font-medium",children:"Sudah Dibayar"}),e.jsx("p",{className:"text-3xl font-bold text-green-900",children:h.total_paid})]})]})]}),a&&e.jsx("div",{className:`rounded-xl border shadow-sm p-6 mb-6 ${a.error?"bg-red-50 border-red-200":"bg-green-50 border-green-200"}`,children:a.error?e.jsx("p",{className:"text-red-700",children:a.error}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"font-bold text-lg mb-3",children:"ðŸ“Š Hasil Auto-Repair"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-zinc-600 text-sm",children:"Disemak"}),e.jsx("p",{className:"text-2xl font-bold",children:a.checked})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-green-600 text-sm",children:"Diperbaiki"}),e.jsx("p",{className:"text-2xl font-bold text-green-700",children:a.fixed})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-600 text-sm",children:"Ralat"}),e.jsx("p",{className:"text-2xl font-bold text-red-700",children:a.errors?.length||0})]})]}),a.details&&a.details.length>0&&e.jsxs("details",{className:"mt-4",children:[e.jsx("summary",{className:"cursor-pointer text-zinc-600 hover:text-zinc-900",children:"Lihat Details"}),e.jsx("div",{className:"mt-2 bg-white rounded-lg p-4 max-h-60 overflow-y-auto",children:a.details.map((s,t)=>e.jsxs("div",{className:"flex justify-between items-center py-2 border-b last:border-0",children:[e.jsx("span",{children:s.child}),e.jsx("span",{className:s.action==="Fixed"?"text-green-600":"text-zinc-500",children:s.action})]},t))})]})]})}),e.jsxs("div",{className:"bg-white rounded-xl border border-zinc-200 shadow-sm",children:[e.jsx("div",{className:"border-b border-zinc-200",children:e.jsxs("div",{className:"flex",children:[e.jsxs("button",{onClick:()=>f("pending"),className:`px-6 py-4 font-medium transition-colors ${l==="pending"?"text-amber-700 border-b-2 border-amber-500 bg-amber-50":"text-zinc-500 hover:text-zinc-900"}`,children:["â³ Menunggu Bayaran (",d.length,")"]}),e.jsxs("button",{onClick:()=>f("paid"),className:`px-6 py-4 font-medium transition-colors ${l==="paid"?"text-green-700 border-b-2 border-green-500 bg-green-50":"text-zinc-500 hover:text-zinc-900"}`,children:["âœ… Sudah Dibayar (",m.length,")"]})]})}),e.jsxs("div",{className:"p-6",children:[l==="pending"&&e.jsx("div",{className:"overflow-x-auto",children:d.length===0?e.jsxs("div",{className:"text-center py-12 text-zinc-500",children:[e.jsx("p",{className:"text-4xl mb-4",children:"ðŸŽ‰"}),e.jsx("p",{children:"Tiada pembayaran pending yang perlu disemak!"})]}):e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-zinc-50",children:[e.jsx("th",{className:"text-left p-3",children:"Peserta"}),e.jsx("th",{className:"text-left p-3",children:"Penjaga"}),e.jsx("th",{className:"text-left p-3",children:"Pusat"}),e.jsx("th",{className:"text-left p-3",children:"Bill Code"}),e.jsx("th",{className:"text-left p-3",children:"Status ToyyibPay"}),e.jsx("th",{className:"text-right p-3",children:"Tindakan"})]})}),e.jsx("tbody",{children:d.map(s=>e.jsxs("tr",{className:"border-t border-zinc-100 hover:bg-zinc-50",children:[e.jsxs("td",{className:"p-3",children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-xs text-zinc-500",children:s.no_siri})]}),e.jsxs("td",{className:"p-3",children:[e.jsx("div",{children:s.parent_name}),e.jsx("div",{className:"text-xs text-zinc-500",children:s.parent_phone})]}),e.jsx("td",{className:"p-3 text-zinc-600",children:s.training_center}),e.jsx("td",{className:"p-3",children:e.jsx("code",{className:"bg-zinc-100 px-2 py-1 rounded text-xs",children:s.payment_reference})}),e.jsx("td",{className:"p-3",children:i[s.id]?e.jsx("div",{className:"text-sm",children:i[s.id].error?e.jsx("span",{className:"text-red-600",children:i[s.id].error}):e.jsxs("div",{children:[e.jsx("span",{className:i[s.id].toyyibpay_status==="Paid"?"text-green-600 font-medium":"text-amber-600",children:i[s.id].toyyibpay_status}),i[s.id].needs_update&&e.jsx("span",{className:"ml-2 bg-red-100 text-red-700 px-2 py-0.5 rounded text-xs",children:"Perlu perbaiki!"})]})}):e.jsx("span",{className:"text-zinc-400",children:"Belum disemak"})}),e.jsx("td",{className:"p-3 text-right",children:e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>v(s.id),disabled:p[s.id],className:"px-3 py-1.5 bg-zinc-100 text-zinc-700 rounded hover:bg-zinc-200 transition-colors text-sm disabled:opacity-50",children:p[s.id]?"...":"ðŸ” Semak"}),i[s.id]?.needs_update&&e.jsx("button",{onClick:()=>k(s.id),disabled:j[s.id],className:"px-3 py-1.5 bg-green-600 text-white rounded hover:bg-green-700 transition-colors text-sm disabled:opacity-50",children:j[s.id]?"...":"âœ… Perbaiki"})]})})]},s.id))})]})}),l==="paid"&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-zinc-50",children:[e.jsx("th",{className:"text-left p-3",children:"Peserta"}),e.jsx("th",{className:"text-left p-3",children:"No. Siri"}),e.jsx("th",{className:"text-left p-3",children:"Pusat"}),e.jsx("th",{className:"text-left p-3",children:"Bill Code"}),e.jsx("th",{className:"text-left p-3",children:"Tarikh Bayar"}),e.jsx("th",{className:"text-right p-3",children:"Jumlah"})]})}),e.jsx("tbody",{children:m.map(s=>e.jsxs("tr",{className:"border-t border-zinc-100 hover:bg-zinc-50",children:[e.jsx("td",{className:"p-3 font-medium",children:s.name}),e.jsx("td",{className:"p-3 text-zinc-600",children:s.no_siri}),e.jsx("td",{className:"p-3 text-zinc-600",children:s.training_center}),e.jsx("td",{className:"p-3",children:e.jsx("code",{className:"bg-green-100 px-2 py-1 rounded text-xs text-green-700",children:s.payment_reference})}),e.jsx("td",{className:"p-3 text-zinc-600",children:s.payment_date}),e.jsxs("td",{className:"p-3 text-right font-medium text-green-600",children:["RM ",s.registration_fee?.toFixed(2)||"-"]})]},s.id))})]})})]})]})]})})]})}export{R as default};
